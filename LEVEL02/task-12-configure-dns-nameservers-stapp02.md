# ğŸ” Task 12 - Configure Google Public DNS Nameservers on App Server 2

**ğŸ“Œ Task Description**

The system admins team of **xFusionCorp Industries** has identified intermittent DNS resolution issues in several applications within the **Stratos Datacenter**. **App Server 2 (stapp02)** is specifically affected, leading to connectivity delays and application timeouts. As a temporary fix and to ensure reliable name resolution, the team has decided to configure **Google Public DNS (IPv4)** as the primary nameservers on this server. This involves modifying the standard resolver configuration file.

**ğŸ‘‰ Task Requirements**:
- **Target Server**: App Server 2 (stapp02) in Stratos Datacenter
- **Nameservers**: Google Public DNS (IPv4)
  - Primary: `8.8.8.8`
  - Secondary: `8.8.4.4`
- **Operation Objectives**:
  - Update `/etc/resolv.conf` with new nameservers
  - Ensure nameservers are prioritized
  - Verify name resolution functionality
- Use `vi` or `tee` for configuration changes
- Prioritize Google DNS for outbound requests
- Test external connectivity after changes

**ğŸ’¡ Note**: Server credentials and infrastructure details are available via the **Details of all Users and Servers** button in the KodeKloud lab interface.

---

## ğŸ”¹ Step 1: Connect to App Server 2

```bash
ssh steve@stapp02
```

**Purpose**: Establish SSH connection to App Server 2 for network configuration.

**Expected Output**:
```
steve@stapp02's password: 
Welcome to App Server 2 - Stratos Datacenter
[steve@stapp02 ~]$
```

**Success Indicators**:
- âœ… Successfully authenticated as user `steve`
- âœ… Command prompt shows `stapp02` hostname

---

## ğŸ”¹ Step 2: Switch to Root User

```bash
sudo su -
```

**Purpose**: Elevate privileges to modify protected system configuration files.

**Expected Output**:
```
[root@stapp02 ~]#
```

**Success Indicators**:
- âœ… Prompt changed to root (#)
- âœ… Administrative access confirmed

---

## ğŸ”¹ Step 3: Verify Current DNS Configuration

```bash
cat /etc/resolv.conf
```

**Purpose**: Review existing nameservers to determine the baseline configuration.

**Expected Output** (sample):
```
# Generated by NetworkManager
search stratos.xfusioncorp.com
nameserver 127.0.0.11
```

**Success Indicators**:
- âœ… Current configuration displayed
- âœ… Understanding of existing resolver setup

---

## ğŸ”¹ Step 4: Configure Google Nameservers in resolv.conf

```bash
vi /etc/resolv.conf
```

**Purpose**: Add Google Public DNS entries to the top of the resolver list.

**Content to Add**:
```text
nameserver 8.8.8.8
nameserver 8.8.4.4
```

**Vi Editor Commands**:
1. Press `i` to enter insert mode
2. Scroll to the top or above existing nameservers
3. Type/Paste the Google DNS entries
4. Press `Esc` to exit insert mode
5. Type `:wq` and press `Enter` to save and exit

**Success Indicators**:
- âœ… File saved successfully
- âœ… New entries present at the beginning of the file

---

## ğŸ”¹ Step 5: Verify Changes in resolv.conf

```bash
cat /etc/resolv.conf
```

**Purpose**: Confirm the file contains the correct IP addresses for Google DNS.

**Expected Output**:
```
nameserver 8.8.8.8
nameserver 8.8.4.4
search stratos.xfusioncorp.com
...
```

**Success Indicators**:
- âœ… `8.8.8.8` is listed
- âœ… `8.8.4.4` is listed
- âœ… Syntax is correct (no trailing spaces or typos)

---

## ğŸ”¹ Step 6: Test Name Resolution and Connectivity

```bash
ping -c 3 google.com
```

**Purpose**: Verify that the server can now resolve external domain names successfully using the new DNS settings.

**Expected Output**:
```
PING google.com (142.250.190.46) 56(84) bytes of data.
64 bytes from ... : icmp_seq=1 ttl=117 time=1.23 ms
64 bytes from ... : icmp_seq=2 ttl=117 time=1.21 ms
64 bytes from ... : icmp_seq=3 ttl=117 time=1.24 ms

--- google.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
```

**Success Indicators**:
- âœ… `google.com` resolved to an IP address
- âœ… Ping responded with 0% packet loss
- âœ… DNS resolution latency is acceptable

---

## ğŸ“‹ Quick Command Reference

Execute the following sequence on **stapp02**:

```bash
# 1. Edit the resolver config
sudo sed -i '1i nameserver 8.8.8.8\nnameserver 8.8.4.4' /etc/resolv.conf

# 2. Verify settings
grep nameserver /etc/resolv.conf

# 3. Test resolution
ping -c 3 xfusioncorp.com
```

---

## ğŸ’¡ Common DNS Configuration Issues & Fixes

### **Issue 1: Overwritten by NetworkManager**
**Problem**: Changes in `/etc/resolv.conf` disappear after reboot or network restart.
**Fix**: Configure DNS via NetworkManager or set the immutable attribute.
```bash
# Quick fix: make file immutable
sudo chattr +i /etc/resolv.conf

# Proper fix: modify connection
sudo nmcli con mod eth0 ipv4.dns "8.8.8.8 8.8.4.4"
sudo nmcli con up eth0
```

### **Issue 2: Resolution Still Failing**
**Problem**: Nameservers are correct but resolution fails.
**Fix**: Check for firewall blocks (Port 53) or local resolver interference.
```bash
# Test specific nameserver
dig @8.8.8.8 google.com
```

### **Issue 3: Slow Resolution**
**Problem**: Server waits for a failing local nameserver before trying Google.
**Fix**: Ensure Google DNS entries are at the *top* of the file.

---

## ğŸ”§ Troubleshooting Failures

### **Error: Destination Host Unreachable**
**Symptoms**: Ping fails even with IP.
**Solution**: Check default gateway and interface status.
```bash
ip route
ip addr show
```

### **Error: /etc/resolv.conf: Permission denied**
**Symptoms**: Root cannot edit the file.
**Solution**: Check for the immutable attribute (`+i`).
```bash
lsattr /etc/resolv.conf
# If 'i' is present:
sudo chattr -i /etc/resolv.conf
```

---

## ğŸš¨ Task-Specific Challenge & Solution

**ğŸ” Main Challenge Encountered**:
The primary challenge in modern Linux distros is that `/etc/resolv.conf` is often managed by dynamic services like `systemd-resolved` or `NetworkManager`. Manual changes can sometimes be transient.

**ğŸ’¡ Solution Approach**:
1. **Direct Modification**: For a "temporary fix" as requested, direct editing of `/etc/resolv.conf` is the most straightforward path.
2. **Prioritization**: Placing the new `nameserver` lines at the top of the file ensures the resolver queries Google DNS before any other pre-configured (and potentially failing) servers.
3. **Connectivity Validation**: Testing with `ping` specifically for a domain name (not an IP) provides proof that the entire resolution chain is working.

**ğŸ¯ Key Success Factors**:
- **Simplicity**: Direct file edit fulfills the "temporary fix" requirement.
- **Verification**: Immediate `cat` and `ping` validation.

---

## âš ï¸ Important Production Notes

ğŸ”§ **Persistence**: Be aware that many systems use `resolvconf` or `NetworkManager` which may overwrite manual edits.
ğŸ” **Security**: Google DNS is reliable but sends lookups outside the corporate network. Ensure this complies with security policy.
ğŸ“Š **Redundancy**: Always provide at least two nameservers for reliability.
âš™ï¸ **Timeout**: Default timeout is usually 5s per server; adding multiple servers improves resiliency.

---

## ğŸ¯ Task Completion Summary

**âœ… Objectives Achieved**:
- Configured **Google Public DNS** (`8.8.8.8`, `8.8.4.4`) on App Server 2.
- Verified that name resolution is functional via `ping` tests.
- Established a reliable temporary fix for intermittent DNS resolution issues.

**ğŸ” Verification Completed**:
- **stapp02**: `/etc/resolv.conf` updated and domains resolving successfully.

**ğŸ”’ Configuration Summary**:
- **Servers**: 8.8.8.8, 8.8.4.4
- **Path**: /etc/resolv.conf
- **Connectivity Status**: Resolved and Verified
- **Scope**: Local to stapp02
